<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>PMTiles turkey</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script type="text/javascript" src="https://ioalexei.github.io/tur_adm2/js/index.js"></script>
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
<!-- add legend script -->
<!-- https://docs.maptiler.com/maplibre-gl-js/control-legend/ -->
<link href='https://watergis.github.io/maplibre-gl-legend/maplibre-gl-legend.css' rel='stylesheet' />
<script src="https://watergis.github.io/maplibre-gl-legend/maplibre-gl-legend.js"></script>
<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>

<body>
<div id="map"></div>

<script>
	var map = new maplibregl.Map({
	container: 'map',
    style: 'https://api.maptiler.com/maps/dataviz/style.json?key=jHKRGcVLQieliF2glneL', // stylesheet location
	center: [36.5, 37.5], // starting position [lng, lat]
	zoom: 6 // starting zoom
	});

	//Add navigation widget https://maplibre.org/maplibre-gl-js-docs/example/navigation/ 
	map.addControl(new maplibregl.NavigationControl());

	// load pmtiles plugin 
	let protocol = new pmtiles.Protocol();
	maplibregl.addProtocol("pmtiles",protocol.tile);

	// pmtiles 
	let PMTILES_URL = "https://ioalexei.github.io/tur_adm2/pmt/data.pmtiles";
    const p = new pmtiles.PMTiles(PMTILES_URL)

    // this is so we share one instance across the JS code and the map renderer
    protocol.add(p);

    map.on('load', () => {

    // Add a new vector tile source with ID 'mapillary'.
    
        map.addSource('pmt', {
            'type': 'vector',
            'url': 'pmtiles://https://ioalexei.github.io/tur_adm2/pmt/data.pmtiles'
            });
        
        map.addSource('protomaps', {
        'type': 'vector',
        "url": "pmtiles://https://ioalexei.github.io/tur_adm2/pmt/data.pmtiles"
            });
        map.addLayer({
            'id':'adm2_lyr', 
            'type': 'fill',
            'source':'protomaps', 
            'source-layer':'tur_adm2', 
            'layout':{},
            'paint':{
                "fill-outline-color": "mediumblue",
                "fill-color": "steelblue",
                "fill-opacity":0.2
            }
        });
        map.addLayer({
            "id":"shops_active",
            "source": "protomaps",
            "source-layer":"20230306shop_locations",
            "type": "circle",
            "paint":{
                "circle-radius":2,
                "circle-color": ["case", ["boolean", ["get", "$IS_ACTIVE"]], true, "limegreen", "grey"]
                // https://developers.arcgis.com/maplibre-gl-js/styles-and-data-visualization/style-a-feature-layer/
                // https://maplibre.org/maplibre-gl-js-docs/example/data-driven-lines/
                // https://docs.mapbox.com/mapbox-gl-js/example/data-driven-circle-colors/

            }
        });


        map.addLayer({
            "id":"atms",
            "source": "protomaps",
            "source-layer":"20230306atm_locations",
            "type": "circle",
            "paint":{
                "circle-radius":2,
                "circle-color":"gold"
            }//,
            // "filter":["==", "$Status", "OPEN"]
        });

        // add legend
        // https://docs.maptiler.com/maplibre-gl-js/control-legend/
        
        });
</script>
</body>
</html>
